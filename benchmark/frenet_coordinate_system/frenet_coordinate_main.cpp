//
// Created by jojo-feng on 23-1-29.
//
#include "frenet_coordinate_system.h"
#include "frenet_coordinate_main.h"
#include "iostream"

msquare::FrenetCoordinateSystem gen_frenet_coordinate(void) {
  std::vector<double> vx =
      {1636.685088, 1637.892801, 1639.090632, 1640.279367, 1641.459769, 1642.632581, 1643.216445, 1643.798701,
       1644.379408, 1644.958705, 1645.536605, 1646.113175, 1646.688577, 1647.262823, 1647.836043, 1648.408246,
       1648.97963, 1649.550144, 1650.119919, 1650.689061, 1651.257562, 1651.825543, 1652.393045, 1652.960174,
       1653.526969, 1654.093505, 1654.659818, 1655.225981, 1655.792122, 1656.358205, 1656.924339, 1657.490581,
       1658.056986, 1658.623552, 1659.190411, 1659.757547, 1660.325079, 1660.892969, 1661.461402, 1662.03026,
       1662.599723, 1663.169752, 1663.740403, 1664.311755, 1664.883794, 1665.456639, 1666.03023, 1666.604631,
       1667.179958, 1667.756118, 1668.333268, 1668.911353, 1669.49039, 1670.070461, 1670.65159, 1671.233764,
       1671.817047, 1672.401473, 1672.986953, 1673.573646, 1674.161515, 1674.750575, 1675.340803, 1675.932282,
       1676.525011, 1677.118988, 1677.714195, 1678.310671, 1678.908437, 1679.507487, 1680.10781, 1680.70947,
       1681.312397, 1681.916636, 1682.522186, 1683.129006, 1683.737134, 1684.346556, 1684.957248, 1685.569222,
       1686.182514, 1686.797011, 1687.412838, 1688.029878, 1688.648108, 1689.267598, 1689.888292, 1690.510159,
       1691.133194, 1691.757366, 1692.382697, 1693.009123, 1693.636606, 1694.265167, 1694.894779, 1695.525373,
       1696.15695, 1696.789437, 1697.422878, 1698.057241, 1698.692373, 1699.328377, 1699.965154, 1700.602672,
       1701.240842, 1701.879752, 1702.51925, 1703.159313, 1703.79991, 1704.441014, 1705.082534, 1705.724467,
       1706.366737, 1707.009307, 1707.652112, 1708.29513, 1708.938217, 1709.581425, 1710.224622, 1710.867812,
       1711.510935, 1712.153827, 1712.796548, 1713.438957, 1714.081041, 1714.722686, 1715.363872, 1716.004425,
       1716.64443, 1717.283693, 1717.922237, 1718.559911, 1719.196657, 1719.832401, 1720.467081, 1721.100588,
       1721.732889, 1722.36386, 1722.993435, 1723.621498, 1724.248026, 1724.872875, 1725.495975, 1726.117204,
       1726.736564, 1727.353876, 1727.969034, 1728.582046, 1729.19273, 1729.800977, 1730.406734, 1731.009872,
       1731.610337, 1732.207942, 1732.802653, 1733.394382, 1733.982928, 1734.568253, 1735.150236, 1735.728741,
       1736.303687, 1736.874974, 1737.44241, 1738.005974, 1738.565459, 1739.671753, 1740.760481, 1741.830657,
       1742.88127, 1743.911292, 1744.919672, 1745.905339, 1746.8672, 1747.804143, 1748.715032, 1749.598712, 1750.454008,
       1751.279721, 1752.074633, 1752.837506, 1753.567079, 1754.262071, 1754.92118, 1755.543082, 1756.126434,
       1756.669871, 1757.172006, 1757.631432, 1758.046722};
  std::vector<double> vy =
      {-842.718861, -844.314672, -845.917405, -847.526509, -849.141451, -850.76171, -851.573599, -852.386661,
       -853.200796, -854.016016, -854.832165, -855.649159, -856.467056, -857.285702, -858.105114, -858.925141,
       -859.745899, -860.567157, -861.388945, -862.211261, -863.03394, -863.857008, -864.680374, -865.50405,
       -866.327948, -867.152039, -867.976238, -868.800517, -869.624934, -870.449306, -871.273666, -872.097975,
       -872.922195, -873.746204, -874.570081, -875.393691, -876.217098, -877.040144, -877.862993, -878.685373,
       -879.507452, -880.329074, -881.150236, -881.970956, -882.791134, -883.610858, -884.429962, -885.248462,
       -886.066449, -886.883718, -887.700428, -888.516435, -889.331702, -890.146283, -890.960159, -891.773255,
       -892.585611, -893.397228, -894.207937, -895.017918, -895.827076, -896.6354, -897.442822, -898.249429,
       -899.055185, -899.860068, -900.664028, -901.4671, -902.269294, -903.070589, -903.870956, -904.670473,
       -905.469042, -906.266717, -907.063498, -907.85933, -908.65427, -909.448304, -910.241413, -911.033625,
       -911.824999, -912.615408, -913.405032, -914.193746, -914.981542, -915.76854, -916.554697, -917.340008,
       -918.124501, -918.908174, -919.691096, -920.473229, -921.254571, -922.035196, -922.815122, -923.594312,
       -924.372825, -925.150629, -925.927838, -926.704475, -927.480415, -928.255854, -929.03074, -929.805107,
       -930.57892, -931.352362, -932.125331, -932.897881, -933.670056, -934.441913, -935.21343, -935.984694,
       -936.755711, -937.526529, -938.297172, -939.067713, -939.838085, -940.608456, -941.378775, -942.14916,
       -942.919653, -943.690173, -944.46091, -945.231817, -946.003001, -946.774454, -947.546279, -948.318399,
       -949.09105, -949.864135, -950.63782, -951.412067, -952.186949, -952.962522, -953.738863, -954.51599, -955.294021,
       -956.072959, -956.852886, -957.633823, -958.415908, -959.199131, -959.98358, -960.769276, -961.556402,
       -962.344914, -963.13486, -963.926442, -964.719617, -965.514438, -966.311038, -967.109447, -967.9098, -968.712058,
       -969.51639, -970.322895, -971.131518, -971.942433, -972.755699, -973.571363, -974.389543, -975.210345,
       -976.033733, -976.859929, -977.688883, -979.355737, -981.034896, -982.727051, -984.432909, -986.153191,
       -987.888633, -989.639985, -991.408013, -993.193497, -994.99723, -996.820024, -998.6627, -1000.526099,
       -1002.411074, -1004.318492, -1006.249236, -1008.204205, -1010.184309, -1012.190476, -1014.223647, -1016.284779,
       -1018.374843, -1020.494823, -1022.64572};

  msquare::FrenetCoordinateSystemParameters param;
  param.zero_speed_threshold = 0.100000;
  param.coord_transform_precision = 0.010000;
  param.step_s = 0.300000;
  param.coarse_step_s = 1.000000;
  param.optimization_gamma = 0.5;
  param.max_iter = 15;

  double v_caculate_s = 33.333333;
  double FLAGS_trajectory_time_length = 8.0;

  msquare::FrenetCoordinateSystem frenet_coordinate_old;
  frenet_coordinate_old.Update(vx, vy, param, 0.0, 30.0 + v_caculate_s * (FLAGS_trajectory_time_length + 1 / 10.0));
  return frenet_coordinate_old;
};

void search_point(msquare::FrenetCoordinateSystem & frenet_coor){
  Point2D cart_point, frenet_point;
  cart_point = {1650.0, -865.0};
  auto status = frenet_coor.CartCoord2FrenetCoord(cart_point,frenet_point);
//  std::cout<< status << std::endl;
};

msquare::FrenetCoordinateSystemNew gen_new_frenet_coordinate(void){
  std::vector<double> vx =
      {1636.685088, 1637.892801, 1639.090632, 1640.279367, 1641.459769, 1642.632581, 1643.216445, 1643.798701,
       1644.379408, 1644.958705, 1645.536605, 1646.113175, 1646.688577, 1647.262823, 1647.836043, 1648.408246,
       1648.97963, 1649.550144, 1650.119919, 1650.689061, 1651.257562, 1651.825543, 1652.393045, 1652.960174,
       1653.526969, 1654.093505, 1654.659818, 1655.225981, 1655.792122, 1656.358205, 1656.924339, 1657.490581,
       1658.056986, 1658.623552, 1659.190411, 1659.757547, 1660.325079, 1660.892969, 1661.461402, 1662.03026,
       1662.599723, 1663.169752, 1663.740403, 1664.311755, 1664.883794, 1665.456639, 1666.03023, 1666.604631,
       1667.179958, 1667.756118, 1668.333268, 1668.911353, 1669.49039, 1670.070461, 1670.65159, 1671.233764,
       1671.817047, 1672.401473, 1672.986953, 1673.573646, 1674.161515, 1674.750575, 1675.340803, 1675.932282,
       1676.525011, 1677.118988, 1677.714195, 1678.310671, 1678.908437, 1679.507487, 1680.10781, 1680.70947,
       1681.312397, 1681.916636, 1682.522186, 1683.129006, 1683.737134, 1684.346556, 1684.957248, 1685.569222,
       1686.182514, 1686.797011, 1687.412838, 1688.029878, 1688.648108, 1689.267598, 1689.888292, 1690.510159,
       1691.133194, 1691.757366, 1692.382697, 1693.009123, 1693.636606, 1694.265167, 1694.894779, 1695.525373,
       1696.15695, 1696.789437, 1697.422878, 1698.057241, 1698.692373, 1699.328377, 1699.965154, 1700.602672,
       1701.240842, 1701.879752, 1702.51925, 1703.159313, 1703.79991, 1704.441014, 1705.082534, 1705.724467,
       1706.366737, 1707.009307, 1707.652112, 1708.29513, 1708.938217, 1709.581425, 1710.224622, 1710.867812,
       1711.510935, 1712.153827, 1712.796548, 1713.438957, 1714.081041, 1714.722686, 1715.363872, 1716.004425,
       1716.64443, 1717.283693, 1717.922237, 1718.559911, 1719.196657, 1719.832401, 1720.467081, 1721.100588,
       1721.732889, 1722.36386, 1722.993435, 1723.621498, 1724.248026, 1724.872875, 1725.495975, 1726.117204,
       1726.736564, 1727.353876, 1727.969034, 1728.582046, 1729.19273, 1729.800977, 1730.406734, 1731.009872,
       1731.610337, 1732.207942, 1732.802653, 1733.394382, 1733.982928, 1734.568253, 1735.150236, 1735.728741,
       1736.303687, 1736.874974, 1737.44241, 1738.005974, 1738.565459, 1739.671753, 1740.760481, 1741.830657,
       1742.88127, 1743.911292, 1744.919672, 1745.905339, 1746.8672, 1747.804143, 1748.715032, 1749.598712, 1750.454008,
       1751.279721, 1752.074633, 1752.837506, 1753.567079, 1754.262071, 1754.92118, 1755.543082, 1756.126434,
       1756.669871, 1757.172006, 1757.631432, 1758.046722};
  std::vector<double> vy =
      {-842.718861, -844.314672, -845.917405, -847.526509, -849.141451, -850.76171, -851.573599, -852.386661,
       -853.200796, -854.016016, -854.832165, -855.649159, -856.467056, -857.285702, -858.105114, -858.925141,
       -859.745899, -860.567157, -861.388945, -862.211261, -863.03394, -863.857008, -864.680374, -865.50405,
       -866.327948, -867.152039, -867.976238, -868.800517, -869.624934, -870.449306, -871.273666, -872.097975,
       -872.922195, -873.746204, -874.570081, -875.393691, -876.217098, -877.040144, -877.862993, -878.685373,
       -879.507452, -880.329074, -881.150236, -881.970956, -882.791134, -883.610858, -884.429962, -885.248462,
       -886.066449, -886.883718, -887.700428, -888.516435, -889.331702, -890.146283, -890.960159, -891.773255,
       -892.585611, -893.397228, -894.207937, -895.017918, -895.827076, -896.6354, -897.442822, -898.249429,
       -899.055185, -899.860068, -900.664028, -901.4671, -902.269294, -903.070589, -903.870956, -904.670473,
       -905.469042, -906.266717, -907.063498, -907.85933, -908.65427, -909.448304, -910.241413, -911.033625,
       -911.824999, -912.615408, -913.405032, -914.193746, -914.981542, -915.76854, -916.554697, -917.340008,
       -918.124501, -918.908174, -919.691096, -920.473229, -921.254571, -922.035196, -922.815122, -923.594312,
       -924.372825, -925.150629, -925.927838, -926.704475, -927.480415, -928.255854, -929.03074, -929.805107,
       -930.57892, -931.352362, -932.125331, -932.897881, -933.670056, -934.441913, -935.21343, -935.984694,
       -936.755711, -937.526529, -938.297172, -939.067713, -939.838085, -940.608456, -941.378775, -942.14916,
       -942.919653, -943.690173, -944.46091, -945.231817, -946.003001, -946.774454, -947.546279, -948.318399,
       -949.09105, -949.864135, -950.63782, -951.412067, -952.186949, -952.962522, -953.738863, -954.51599, -955.294021,
       -956.072959, -956.852886, -957.633823, -958.415908, -959.199131, -959.98358, -960.769276, -961.556402,
       -962.344914, -963.13486, -963.926442, -964.719617, -965.514438, -966.311038, -967.109447, -967.9098, -968.712058,
       -969.51639, -970.322895, -971.131518, -971.942433, -972.755699, -973.571363, -974.389543, -975.210345,
       -976.033733, -976.859929, -977.688883, -979.355737, -981.034896, -982.727051, -984.432909, -986.153191,
       -987.888633, -989.639985, -991.408013, -993.193497, -994.99723, -996.820024, -998.6627, -1000.526099,
       -1002.411074, -1004.318492, -1006.249236, -1008.204205, -1010.184309, -1012.190476, -1014.223647, -1016.284779,
       -1018.374843, -1020.494823, -1022.64572};

  msquare::FrenetCoordinateSystemParameters param;
  param.zero_speed_threshold = 0.100000;
  param.coord_transform_precision = 0.010000;
  param.step_s = 0.300000;
  param.coarse_step_s = 1.000000;
  param.optimization_gamma = 0.5;
  param.max_iter = 15;
  std::vector<Point2D> vec_vxy;
  int min_len_xy = std::min(vx.size(),vy.size());
  for(int i =0;i<min_len_xy;i++){
    Point2D tmp = {vx[i],vy[i]};
    vec_vxy.emplace_back(tmp);
  }

  msquare::FrenetCoordinateSystemNew res = msquare::FrenetCoordinateSystemNew(vec_vxy,param);
  return  res;
};

void search_point_new(msquare::FrenetCoordinateSystemNew & frenet_coor){
  Point2D cart_point, frenet_point;
  cart_point = {1650.0, -865.0};
  auto status = frenet_coor.CartCoord2FrenetCoord(cart_point,frenet_point);
//  std::cout<< status << std::endl;
};
